#### 模板指令

- 组件上 v-model 用法已更改
- `<template v-for>`和 非 `v-for`节点上 key 用法已更改
- 在同一元素上使用的 v-if 和 `v-for` 优先级已更改
- `v-bind="object"` 现在排序敏感
- `v-for` 中的 `ref` 不再注册 `ref` 数组

#### 组合式 API

- Vue3 引入了组合式 API，这是一个新的编写组件逻辑的方式。相比于 Vue2 的选项式 API，组合式 API 更加灵活和可组合，使得代码的**复用性**和可读性更强。

以下是一些组合式 API 的关键特性及其功能：

1. 响应式状态： `reactive`\*\*` 函数创建一个响应式对象，类似于 Vue 2 中的 data 选项。它允许您定义和跟踪组件中的响应式状态变量。
2. Refs： `ref` 函数创建对值的响应式引用。通常用于创建响应式的原始值，如数字、字符串或布尔值。可以访问和修改 ref 的 value 属性。
3. 计算属性： `computed `函数创建一个计算属性，类似于 Vue 2 中的 computed 选项。它允许您基于响应式依赖定义计算值，并在这些依赖发生变化时自动更新。
4. 生命周期钩子：组合式 API 提供了类似于 `onMounted` 、 `onUpdated` 、 `onUnmounted` 等生命周期钩子函数。这些钩子函数允许您在组件的不同生命周期阶段执行特定的操作。
5. 自定义逻辑复用：通过使用 function 或 composable 函数，您可以将逻辑封装为可复用的组合函数。这些函数可以在多个组件中共享和调用，**提高了代码的可维护性和复用性**。

#### 新的生命周期

- setup

**setup** 函数被用作替代 Vue 2 中基于选项的生命周期钩子的方式。它是一个特殊的函数，在**组件创建之前执行**，用于初始化和配置组件。 可以用于初始化组件、访问 `props` 和 `context`、定义响应式变量以及执行类似于生命周期钩子的操作。它提供了更灵活和强大的方式来配置和管理组件。可以使用组合式 API，如 `onMounted` 来在组件挂载后执行一些操作，使用 `onUpdated` 来在组件更新后执行一些操作，等等。

#### TypeScript 支持

- Vue3 对 `TypeScript` 的支持更加友好。它提供了完整的 `TypeScript` 类型定义，使得**在开发过程中能够更好地进行类型检查和代码提示**。

#### 缩小包大小

- Vue3 通过优化内部机制和剔除一些不常用的特性，使得**打包后的代码体积更小，加载速度更快**。

#### 性能优化

1. 基于 **Proxy** 的响应式系统，使得数据变化的追踪更加高效。

- 因为 `Proxy` 代理的直接是整个对象,效率更高。例如对象中有 100 个属性，用 `defineProperty` 劫持至少需要递推循环 100 次，而 proxy 一次搞定。

- `defineProperty` 对数组中存在大量元素的劫持操作性能不好，所以 Vue2 并没有直接使用 `defineProperty` 对数组进行劫持，而是改写了数组操作的 7 个方法（。 push() 往数组最后面添加一个元素，成功返回当前数组的长度。 pop() 删除数组的最后一个元素，成功返回删除元素的值。 shift() 删除数组的第一个元素，成功返回删除元素的值。 unshift() 往数组最前面添加一个元素，成功返回当前数组的长度。 splice() 有三个参数，第一个是想要删除的元素的下标（必选），第二个是想要删除的个数（必选），第三个是删除后想要在原位置替换的值（可选） 。返回删除的数组 sort() 使数组按照字符编码默认从小到大排序,成功返回排序后的数组 reverse() 将数组倒序，成功返回倒序后的数组）

- Vue2 中，劫持数据的操作在实例创建完成就已经进行完毕了，所以对对象后续新增的属性是劫持不到的，也就意味着后续新增的属性是不具备响应式能力的，所以 Vue2 不得不提供了 `$set` 方法。而换成 proxy 就不存在这个问题了，因为它劫持的整个对象，后续添加的属性也是属于这个对象的，那么 `$set` 也就没有必要了（干掉 `$set` 方法本身也是性能的一个体现）。

2. 模板编译优化

- **静态提升（Static Hoisting）**：Vue3 的编译器引入了静态提升的概念，它将模板中的静态节点提升为常量，从而减少了运行时的开销。这使得 Vue3 的渲染性能比 Vue2 更好。

- **Fragments**：Vue3 支持模板中的片段（Fragments），这是一种可以在模板中返回多个根元素的方式。在 Vue2 中，模板必须有一个根元素，而在 Vue3 中，可以使用片段来避免这个限制。

- **静态属性提升**（Static Props Hoisting）：Vue3 的编译器还引入了静态属性提升的优化。它会将静态属性提升为常量，从而减少了运行时的属性访问开销。

- **编译标记**（Compile-time Directive）：Vue3 的编译器支持编译时指令，这是一种在编译阶段处理指令的方式。这使得一些指令的处理可以在编译时完成，而不需要在运行时进行解析和处理。

3. 优化 diff 算法。

- 采用**最长递增子序列算法**，更高效的计算出需要更新的部分。
- 事件监听缓存
