##### 什么是虚拟 DOM

Vue 的虚拟 DOM（Virtual DOM）是 Vue 框架中的一个重要概念。它是一个轻量级的 JavaScript 对象，用于描述真实 DOM 的层次结构。为 Vue 带来了跨平台的能力

实际上它只是一层对真实 DOM 的抽象，以 JavaScript 对象 (VNode 节点) 作为基础的树，用对象的属性来描述节点，最终可以通过一系列操作使这棵树映射到真实环境上。

在 Javascript 对象中，虚拟 DOM 表现为一个 Object 对象。并且最少包含标签名 (tag)、属性 (attrs) 和子元素对象 (children) 三个属性，不同框架对这三个属性的名命可能会有差别。

创建虚拟 DOM 就是为了更好将虚拟的节点渲染到页面视图中，所以虚拟 DOM 对象的节点与真实 DOM 的属性一一照应。

```vue
...
<div id="app">
  <p class="p">节点内容</p>
  <h3>{{ foo }}</h3>
</div>
...
<script>
...
const app = new Vue({
  el: '#app',
  data: {
    foo: 'foo',
  },
})
...
</script>
```

调用 render 函数，我们能得到虚拟 DOM

```js
(function anonymous() {
  with (this) {
    return _c("div", { attrs: { id: "app" } }, [
      _c("p", { staticClass: "p" }, [_v("节点内容")]),
      _v(" "),
      _c("h3", [_v(_s(foo))]),
    ]);
  }
});
```

##### 为什么需要虚拟 DOM

- 性能优化

有些文章会说操作真实 DOM 代价太大，所有操作虚拟 DOM 会让性能提升。

**这种说法显然是错的。**

因为操作虚拟 DOM 之后仍然需要操作真实 DOM，这样就在原有的操作上多执行了一些代码，还会导致性能变差。

**那么为什么还会说虚拟 DOM 可以优化性能呢？**

虚拟 DOM 的作用是在数据发生变化时，通过 diff 算法比较新旧虚拟 DOM 的差异，只更新需要更新的部分，而不是直接操作真实的 DOM。这样可以减少对真实 DOM 的操作次数，从而提高应用的性能。

主要体现在以下几个方面：

1. 减少真实 DOM 操作：虚拟 DOM 通过 diff 算法比较差异，只更新变化的部分，避免了不必要的 DOM 操作，从而减少了浏览器的工作量。
2. 批量更新：虚拟 DOM 会将多次 DOM 操作合并为一次，减少了重绘和回流的次数，提高了渲染的效率。
3. 异步更新：Vue 使用异步更新策略，将多个数据变化的更新合并到一起，避免了频繁的 DOM 操作，提升了性能。

- 跨平台

真实 DOM 依赖浏览器环境，而虚拟 DOM 是普通的 JS 对象。因此，无论是在浏览器、移动端还是服务器端，只要有 JavaScript 环境，就可以使用虚拟 DOM 进行渲染和更新。

具体来说，虚拟 DOM 可以通过不同的渲染引擎将其转换为平台特定的真实 DOM。在浏览器中，可以使用浏览器的原生 API 将虚拟 DOM 转换为真实 DOM 并进行渲染。在移动端，可以使用类似 React Native 的框架将虚拟 DOM 转换为移动平台上的原生组件。在服务器端，可以使用类似 Node.js 的环境将虚拟 DOM 转换为 HTML 字符串并发送给客户端。

这种跨平台的特性使得 Vue 等基于虚拟 DOM 的框架能够在不同的环境中使用相同的代码进行开发和维护，提高了开发效率和代码复用性。同时，也为开发者提供了更大的灵活性，可以选择在不同平台上进行渲染，以适应不同的应用场景和需求。
